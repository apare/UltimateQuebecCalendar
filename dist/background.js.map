{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/background.ts","webpack:///./src/googleApi.ts","webpack:///./src/localStorage.ts","webpack:///./src/utils.ts","webpack:///external \"axios\"","webpack:///external \"tslib\""],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;;;;;;;;;AClF6C;AAOxB;AACkB;AAIhC,SAAS,YAAY;IAC1B,+DAAY,CAAC,IAAI,CAAC,CAAC;IACnB,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,YAAY,EAAE,EAAE;QACrE,IAAI,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE;YAC/B,SAAS,CAAC,OAAO,EAAE,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;SACjD;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAe,SAAS,CACtB,OAE2D,EAC3D,KAAa,EACb,aAAwB;;QAExB,IAAI;YACF,MAAM,UAAU,GAAG,MAAM,iEAAW,EAAE,CAAC;YACvC,IAAI,UAAU,EAAE;gBACd,IAAI,OAAO,CAAC,MAAM,KAAK,aAAa,EAAE;oBACpC,MAAM,KAAK,GAAG,MAAM,8DAAW,CAAC,UAAU,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;oBAC3D,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE;wBAC/B,IAAI,EAAE,sCAAsC,2DAAY,CAAC,KAAK,CAAC,GAAG;qBACnE,CAAC,CAAC;iBACJ;qBAAM,IAAI,OAAO,CAAC,MAAM,KAAK,aAAa,EAAE;oBAC3C,MAAM,KAAK,GAAG,MAAM,8DAAW,CAAC,UAAU,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;oBAC3D,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE;wBAC/B,IAAI,EAAE,sCAAsC,2DAAY,CAAC,KAAK,CAAC,GAAG;qBACnE,CAAC,CAAC;iBACJ;qBAAM,IAAI,OAAO,CAAC,MAAM,KAAK,MAAM,EAAE;oBACpC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oBAC9B,aAAa,CAAC,KAAK,EAAE,oBAAoB,CAAC,CAAC;oBAC3C,MAAM,MAAM,GAAG,MAAM,4DAAS,CAAC,UAAU,CAAC,CAAC;oBAC3C,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE;wBAC/B,IAAI,EAAE,+BAA+B,2DAAY,CAC/C,UAAU,EACV,MAAM,CACP,GAAG;qBACL,CAAC,CAAC;iBACJ;aACF;iBAAM;gBACL,SAAS,CAAC,KAAK,EAAE,sBAAsB,CAAC,CAAC;aAC1C;SACF;QAAC,OAAO,KAAK,EAAE;YACd,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;SACzB;IACH,CAAC;CAAA;AAED,SAAS,SAAS,CAAC,KAAa,EAAE,KAAU;IAC1C,aAAa,CAAC,KAAK,EAAE,oBAAoB,EAAE,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC7D,IAAI,KAAK,IAAI,qBAAqB,EAAE;QAClC,+DAAY,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YAC1B,MAAM,CAAC,QAAQ,CAAC,qBAAqB,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;KACJ;AACH,CAAC;AAED,SAAS,aAAa,CAAC,KAAa,EAAE,IAAY,EAAE,KAAc;IAChE,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC;QACxB,KAAK;QACL,IAAI,EAAE,UAAU,IAAI,EAAE;KACvB,CAAC,CAAC;IACH,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;QACzB,KAAK;QACL,KAAK,EAAE,2BAA2B,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE;KACvE,CAAC,CAAC;AACL,CAAC;AAED,YAAY,EAAE,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;AChFW;AAkDnB,IAAI,WAAmB,CAAC;AAE/B,SAAe,IAAI,CACjB,MAAc,EACd,GAAW,EACX,MAA+B,EAC/B,IAA6B;;QAE7B,MAAM,KAAK,GAAG,MAAM,YAAY,EAAE,CAAC;QAEnC,IAAI,MAAM,IAAI,IAAI,EAAE;YAClB,MAAM,GAAG,EAAE,CAAC;SACb;QACD,MAAM,CAAC,cAAc,CAAC,GAAG,KAAK,CAAC;QAC/B,MAAM,QAAQ,GAAG,MAAM,4CAAK,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;QAC5D,IAAI,QAAQ,CAAC,MAAM,IAAI,GAAG,IAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,EAAE;YACnD,OAAO,QAAQ,CAAC,IAAS,CAAC;SAC3B;aAAM;YACL,MAAM,QAAQ,CAAC,IAAI,CAAC;SACrB;IACH,CAAC;CAAA;AAEM,SAAS,YAAY;IAC1B,OAAO,IAAI,CAAe,KAAK,EAAE,mCAAmC,EAAE;QACpE,MAAM,EAAE,mBAAmB;KAC5B,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;AAChC,CAAC;AAEM,SAAS,cAAc,CAAC,eAAuB;IACpD,OAAO,IAAI,CAAW,MAAM,EAAE,uBAAuB,EAAE,SAAS,EAAE;QAChE,OAAO,EAAE,eAAe;KACzB,CAAC,CAAC;AACL,CAAC;AAEM,SAAS,SAAS,CAAC,UAAkB;IAC1C,OAAO,IAAI,CACT,KAAK,EACL,wBAAwB,GAAG,kBAAkB,CAAC,UAAU,CAAC,GAAG,SAAS,EACrE;QACE,UAAU,EAAE,IAAI;QAChB,MAAM,EACJ,qEAAqE;QACvE,sBAAsB,EAAE,cAAc;KACvC,CACF,CAAC,IAAI,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;AAC/B,CAAC;AAEM,SAAS,WAAW,CAAC,UAAkB,EAAE,KAAY;IAC1D,OAAO,IAAI,CACT,MAAM,EACN,wBAAwB,GAAG,kBAAkB,CAAC,UAAU,CAAC,GAAG,SAAS,EACrE;QACE,MAAM,EAAE,8DAA8D;KACvE,EACD,KAAK,CACN,CAAC;AACJ,CAAC;AAEM,SAAe,WAAW,CAAC,UAAkB,EAAE,KAAY;;QAChE,IAAI,KAAK,CAAC,EAAE,EAAE;YACZ,MAAM,IAAI,CACR,QAAQ,EACR,wBAAwB;gBACtB,kBAAkB,CAAC,UAAU,CAAC;gBAC9B,UAAU;gBACV,kBAAkB,CAAC,KAAK,CAAC,EAAE,CAAC,CAC/B,CAAC;YACF,KAAK,CAAC,EAAE,GAAG,SAAS,CAAC;SACtB;QACD,OAAO,KAAK,CAAC;IACf,CAAC;CAAA;AAEM,SAAS,YAAY,CAAC,MAAM,GAAG,KAAK;IACzC,OAAO,IAAI,OAAO,CAAS,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QAC7C,IAAI;YACF,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,WAAW,EAAE,MAAM,EAAE,EAAE,KAAK,CAAC,EAAE;gBAC5D,IAAI,KAAK,IAAI,IAAI,EAAE;oBACjB,IAAI,MAAM,CAAC,OAAO,CAAC,SAAS,EAAE;wBAC5B,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;qBAC1C;oBACD,MAAM,CAAC,sBAAsB,CAAC,CAAC;iBAChC;qBAAM;oBACL,OAAO,CAAC,KAAK,CAAC,CAAC;iBAChB;YACH,CAAC,CAAC,CAAC;SACJ;QAAC,OAAO,CAAC,EAAE;YACV,MAAM,CAAC,CAAC,CAAC,CAAC;SACX;IACH,CAAC,CAAC,CAAC;AACL,CAAC;;;;;;;;;;;;;;;;;;;;AC3I0C;AAEpC,SAAe,WAAW;;QAC/B,IAAI,QAAQ,GAAG,YAAY,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAChD,IAAI,QAAQ,EAAE;YACZ,OAAO,QAAQ,CAAC;SACjB;QAED,MAAM,SAAS,GAAG,MAAM,+DAAY,EAAE,CAAC;QACvC,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;YACxB,WAAW,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAC7B,OAAO,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;SACxB;QACD,OAAO,IAAI,CAAC;IACd,CAAC;CAAA;AAEM,SAAS,WAAW,CAAC,EAAU;IACpC,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;AACvC,CAAC;;;;;;;;;;;;;AClBD;AAAA;AAAO,SAAS,YAAY,CAAC,GAAG,MAAa;IAC3C,OAAO,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC9D,CAAC;;;;;;;;;;;;ACFD,kC;;;;;;;;;;;ACAA,kC","file":"background.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/background.ts\");\n","import { getCalendar } from \"./localStorage\";\nimport {\n  authenticate,\n  createEvent,\n  Event,\n  deleteEvent,\n  getEvents\n} from \"./googleApi\";\nimport { encodeParams } from \"./utils\";\n\nexport type Action = \"createEvent\" | \"deleteEvent\" | \"init\";\n\nexport function setupHandler() {\n  authenticate(true);\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n    if (sender.tab && sender.tab.id) {\n      onMessage(request, sender.tab.id, sendResponse);\n    }\n  });\n}\n\nasync function onMessage(\n  request:\n    | { action: \"init\" }\n    | { action: \"createEvent\" | \"deleteEvent\"; event: Event },\n  tabId: number,\n  _sendResponse?: Function\n) {\n  try {\n    const calendarId = await getCalendar();\n    if (calendarId) {\n      if (request.action === \"createEvent\") {\n        const event = await createEvent(calendarId, request.event);\n        chrome.tabs.executeScript(tabId, {\n          code: `UltimateQuebecCalendar.updateEvent(${encodeParams(event)})`\n        });\n      } else if (request.action === \"deleteEvent\") {\n        const event = await deleteEvent(calendarId, request.event);\n        chrome.tabs.executeScript(tabId, {\n          code: `UltimateQuebecCalendar.updateEvent(${encodeParams(event)})`\n        });\n      } else if (request.action === \"init\") {\n        chrome.pageAction.show(tabId);\n        setPageAction(tabId, \"calendar_ready.png\");\n        const events = await getEvents(calendarId);\n        chrome.tabs.executeScript(tabId, {\n          code: `UltimateQuebecCalendar.init(${encodeParams(\n            calendarId,\n            events\n          )})`\n        });\n      }\n    } else {\n      showError(tabId, \"No calendar selected\");\n    }\n  } catch (error) {\n    showError(tabId, error);\n  }\n}\n\nfunction showError(tabId: number, error: any) {\n  setPageAction(tabId, \"calendar_error.png\", error.toString());\n  if (error == \"Invalid Credentials\") {\n    authenticate().then(token => {\n      chrome.identity.removeCachedAuthToken({ token });\n    });\n  }\n}\n\nfunction setPageAction(tabId: number, icon: string, title?: string) {\n  chrome.pageAction.setIcon({\n    tabId,\n    path: `assets/${icon}`\n  });\n  chrome.pageAction.setTitle({\n    tabId,\n    title: `Ultimate Quebec Calendar${title != null ? \" - \" + title : \"\"}`\n  });\n}\n\nsetupHandler();\n","import axios from \"axios\";\n\nexport interface Calendar {\n  id: string;\n  summary: string;\n}\n\nexport interface CalendarList {\n  items: Calendar[];\n}\n\nexport interface Start {\n  dateTime: string;\n}\n\nexport interface End {\n  dateTime: string;\n}\n\nexport interface Properties {\n  [key: string]: string;\n}\n\nexport interface ExtendedProperties {\n  private?: Properties;\n  shared?: Properties;\n}\n\nexport interface EventExtendedProperties {\n  shared: EventExtendedPropertiesShared;\n}\n\nexport interface EventExtendedPropertiesShared {\n  UQCalendar: string;\n  Uid: string;\n}\n\nexport interface Event {\n  id?: string;\n  summary: string;\n  extendedProperties: EventExtendedProperties;\n  location?: string;\n  start: Start;\n  end: End;\n}\n\nexport interface EventList {\n  items: Event[];\n}\n\nexport var accessToken: string;\n\nasync function call<T>(\n  method: string,\n  url: string,\n  params?: { [key: string]: any },\n  data?: { [key: string]: any }\n) {\n  const token = await authenticate();\n\n  if (params == null) {\n    params = {};\n  }\n  params[\"access_token\"] = token;\n  const response = await axios({ method, url, params, data });\n  if (response.status >= 200 && response.status < 300) {\n    return response.data as T;\n  } else {\n    throw response.data;\n  }\n}\n\nexport function getCalendars() {\n  return call<CalendarList>(\"GET\", \"calendar/v3/users/me/calendarList\", {\n    fields: \"items(id,summary)\"\n  }).then(({ items }) => items);\n}\n\nexport function createCalendar(calendarSummary: string) {\n  return call<Calendar>(\"POST\", \"calendar/v3/calendars\", undefined, {\n    summary: calendarSummary\n  });\n}\n\nexport function getEvents(calendarId: string) {\n  return call<EventList>(\n    \"GET\",\n    \"calendar/v3/calendars/\" + encodeURIComponent(calendarId) + \"/events\",\n    {\n      maxResults: 2500,\n      fields:\n        \"items(id, summary, extendedProperties/shared, location, start, end)\",\n      sharedExtendedProperty: \"UQCalendar=3\"\n    }\n  ).then(({ items }) => items);\n}\n\nexport function createEvent(calendarId: string, event: Event) {\n  return call<Event>(\n    \"POST\",\n    \"calendar/v3/calendars/\" + encodeURIComponent(calendarId) + \"/events\",\n    {\n      fields: \"id, summary, extendedProperties/shared, location, start, end\"\n    },\n    event\n  );\n}\n\nexport async function deleteEvent(calendarId: string, event: Event) {\n  if (event.id) {\n    await call(\n      \"DELETE\",\n      \"calendar/v3/calendars/\" +\n        encodeURIComponent(calendarId) +\n        \"/events/\" +\n        encodeURIComponent(event.id)\n    );\n    event.id = undefined;\n  }\n  return event;\n}\n\nexport function authenticate(prompt = false) {\n  return new Promise<string>((resolve, reject) => {\n    try {\n      chrome.identity.getAuthToken({ interactive: prompt }, token => {\n        if (token == null) {\n          if (chrome.runtime.lastError) {\n            reject(chrome.runtime.lastError.message);\n          }\n          reject(\"Something went wrong\");\n        } else {\n          resolve(token);\n        }\n      });\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n","import { getCalendars } from \"./googleApi\";\n\nexport async function getCalendar() {\n  var calendar = localStorage.getItem(\"Calendar\");\n  if (calendar) {\n    return calendar;\n  }\n\n  const calendars = await getCalendars();\n  if (calendars.length > 0) {\n    setCalendar(calendars[0].id);\n    return calendars[0].id;\n  }\n  return null;\n}\n\nexport function setCalendar(id: string) {\n  localStorage.setItem(\"Calendar\", id);\n}\n","export function encodeParams(...params: any[]) {\n  return params.map(value => JSON.stringify(value)).join(\",\");\n}\n","module.exports = require(\"axios\");","module.exports = require(\"tslib\");"],"sourceRoot":""}